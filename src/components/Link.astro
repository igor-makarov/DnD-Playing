---
import { getAllRoutes } from "@/js/utils/routes";

interface Props {
  to: string; // e.g., "/classes/Fighter-XPHB" - must start with /
  class?: string;
}

const { to, class: className, ...rest } = Astro.props;
const base = import.meta.env.BASE_URL;

// Normalize: ensure leading slash, remove trailing slash for comparison
const normalizedTo = "/" + to.replace(/^\//, "").replace(/\/$/, "");

// Build href with base URL and trailing slash
const href = `${base}${normalizedTo.slice(1)}/`;

// Build-time validation
const validRoutes = getAllRoutes();
if (!validRoutes.has(normalizedTo)) {
  const routeList = [...validRoutes].sort().join("\n  ");
  throw new Error(`Link destination "${to}" does not match any known route.\n\nValid routes:\n  ${routeList}`);
}
---

<a href={href} class={className} {...rest}><slot /></a>
