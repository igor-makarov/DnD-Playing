---
import AbilitiesTable from "@/components/AbilitiesTable.astro";
import SkillsTable from "@/components/SkillsTable.astro";
import SavesTable from "@/components/SavesTable.astro";
import WeaponAttackTable from "@/components/WeaponAttackTable.astro";
import D20TestCell from "@/components/common/D20TestCell.tsx";
import HitPointsInput from "@/components/HitPointsInput.tsx";
import SpellSlotsTables from "@/components/SpellSlotsTables.astro";
import ChannelDivinityCheckboxes from "@/components/classes/paladin/ChannelDivinityCheckboxes.tsx";
import LayOnHandsInput from "@/components/classes/paladin/LayOnHandsInput.tsx";
import HitDiceTable from "@/components/HitDiceTable.tsx";

import { DiceString } from "@/js/common/DiceString.ts";
import AzamatCharacter from "@/js/characters/AzamatCharacter";
import LevelledSpellDamageRow from "@/components/spells/LevelledSpellDamageRow.astro";
import "@/styles/style.css";

const character = new AzamatCharacter();
const characterName = "Azamat";
---

<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{import.meta.env.DEV ? "[dev] " : ""}{characterName}</title>
    <base target="_blank" />
  </head>
  <body>
    <div class="row six-across">
      <AbilitiesTable character={character} />
    </div>
    <div class="row four-across">
      <div class="column">
        <table>
          <tr>
            <th style="text-align: center;">Proficiency Bonus</th>
          </tr>
          <tr>
            <td class="modifier" style="text-align: center;">
              <span class="mono">+{character.proficiencyBonus}&nbsp;</span>
            </td>
          </tr>
        </table>
      </div>
      <div class="column">
        <table>
          <tr>
            <th style="text-align: center;">AC</th>
          </tr>
          <tr>
            <td style="text-align: center;">
              <span class="mono">20</span>
            </td>
          </tr>
        </table>
      </div>
      <div class="column">
        <table>
          <tr>
            <th style="text-align: center;">HP</th>
          </tr>
          <tr>
            <td style="text-align: center;">
              <HitPointsInput client:load hitPointMaximum={character.getHitPoints()} hitDiceByType={character.getHitDice()} />
            </td>
          </tr>
        </table>
      </div>
      <div class="column">
        <table>
          <tr>
            <th style="text-align: center;">Initiative</th>
          </tr>
          <tr>
            <td class="modifier" style="text-align: center;">
              <span class="checkCell">
                <D20TestCell client:load roll={character.getInitiative()} advantage={true} />
              </span>
            </td>
          </tr>
        </table>
      </div>
    </div>

    <div class="row three-and-large">
      <div class="column">
        <SkillsTable
          title={'Skills<br><a href="https://www.dungeonmastersvault.com/pages/dnd/5e/characters/17592319397230">character sheet</a>'}
          character={character}
        />
      </div>
      <div class="column">
        <SavesTable title="Saves (with added Cha)" character={character} />
        <SavesTable
          title={'<a href="https://2014.5e.tools/races.html#warforged_erlw">Constructed Resilience</a><br>ADV against poison<br>also half damage'}
          savingThrows={character.getSavingThrows().filter((s) => s.ability == "Con")}
          advantage={true}
          character={character}
        />
        <HitDiceTable client:load hitDice={character.getHitDice()} conModifier={character.getAbilityModifier("Con")} />
      </div>
      <div class="column">
        <WeaponAttackTable character={character} />
        <table>
          <tbody>
            <tr>
              <th colspan="2" style="text-align: center;">Other Spells</th>
            </tr>
            <tr>
              <td>Spell Attack Modifier</td>
              <td class="checkCell mono">
                <D20TestCell client:load roll={character.getSpellAttack()} />
              </td>
            </tr>
            <tr>
              <td>Spell Save DC</td>
              <td class="checkCell mono">
                <span class="mono">{character.getSpellSaveDC()}</span>
              </td>
            </tr>
            <tr>
              <th>Spell</th>
              <th class="modifier">Damage</th>
            </tr>
            <LevelledSpellDamageRow
              name="Moonbeam"
              damageOptions={character.getDamageProgression({ level: 2, damage: new DiceString("2d10") }, new DiceString("1d10"))}
            />
          </tbody>
        </table>
      </div>
      <div class="column features">
        <SpellSlotsTables character={character} />
        <table>
          <tr>
            <th colspan="2" style="text-align: center;">Features</th>
          </tr>
          <tr>
            <th>Feature</th>
            <th class="modifier">Effect</th>
          </tr>
          <tr>
            <td>Lay on Hands</td>
            <td class="modifier">
              <LayOnHandsInput client:load layOnHandsMaximum={character.getLayOnHandsMaximum()} /> per long rest
            </td>
          </tr>
          <tr>
            <td>Channel Divinity</td>
            <td class="modifier">
              <ChannelDivinityCheckboxes client:load maxUses={character.getChannelDivinity()} />
            </td>
          </tr>
          <tr>
            <td>[CD] Divine Sense (60ft)</td>
            <td class="modifier">celestial/fiend/undead</td>
          </tr>
          <tr>
            <td>[CD] Harness Divine Power</td>
            <td class="modifier">
              max slot lv: <span class="mono">{Math.ceil(0.5 * character.proficiencyBonus)}</span>
            </td>
          </tr>
          <tr>
            <td>[CD] Watcher's Will (30ft)</td>
            <td class="modifier">
              <span class="mono">{character.getAbilityModifier("Cha")}</span> + self
            </td>
          </tr>
          <tr>
            <td>[CD] Abjure the Extraplanar (30ft)</td>
            <td class="modifier">WIS save</td>
          </tr>
          <tr>
            <td>Cleansing Touch</td>
            <td class="modifier">
              <span class="mono">{character.getAbilityModifier("Cha")}</span>/long rest
            </td>
          </tr>
          <tr>
            <td>Aura of Protection (10ft)</td>
            <td class="modifier">
              <span class="mono">+{character.getAbilityModifier("Cha")}&nbsp;</span>
            </td>
          </tr>
          <tr>
            <td>Aura of the Sentinel (10ft)</td>
            <td class="modifier">Advantage: Initiative</td>
          </tr>
          <tr>
            <td>Aura of Courage (10ft)</td>
            <td class="modifier">Immunity: frightened</td>
          </tr>
        </table>
      </div>
    </div>
  </body>
</html>
